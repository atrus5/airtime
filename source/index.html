<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Fryer Times</title>
    <!-- Tailwind CSS for utility classes -->
    <script src="https://cdn.tailwindcss.com"></script>
        <!-- This script MUST be here to enable class-based dark mode for the Tailwind CDN -->
    <script>
      tailwind.config = {
        darkMode: 'class'
      }
    </script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    
    <script>
        // This small script runs before the rest of the page loads.
        // It checks for a saved theme in localStorage or the user's system preference.
        // This prevents the "flash of unstyled content" (FOUC) where the wrong theme briefly appears.
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
    </script>

    <style>
        body { font-family: 'Poppins', sans-serif; }
        .app-container { max-width: 480px; margin: 0 auto; min-height: 100vh; box-shadow: 0 0 15px rgba(0, 0, 0, 0.05); }
        .toggle-checked:checked + .toggle-label { background-color: #4f46e5; }
        .toggle-checked:checked + .toggle-label .toggle-dot { transform: translateX(100%); }
        .card { transition: all 0.3s ease; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .dark .card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2); }
        .add-timer-modal, .food-category-modal, .export-modal { transition: opacity 0.3s ease; }
        .temp-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 25px; height: 25px; border-radius: 50%; background: #4f46e5; cursor: pointer; }
        .temp-slider::-moz-range-thumb { width: 25px; height: 25px; border-radius: 50%; background: #4f46e5; cursor: pointer; }
        .category-icon { width: 40px; height: 40px; }
        .toast { position: fixed; top: 20px; right: 20px; max-width: 300px; z-index: 100; transform: translateY(-100px); transition: transform 0.3s ease; }
        .toast.show { transform: translateY(0); }
    </style>
</head>
<body class="bg-gray-100 dark:bg-slate-900">
    <!-- Main Application Container -->
    <div class="app-container bg-white dark:bg-slate-800">
        <!-- Header Section -->
        <header class="bg-indigo-600 dark:bg-slate-900 text-white p-4 flex justify-between items-center">
            <h1 class="text-xl font-bold">Air Fryer Times</h1>
            <div class="flex items-center space-x-2">
                <div id="auth-container" class="flex items-center space-x-2">
                    <button id="google-signin-btn" class="bg-white text-indigo-600 px-3 py-1 rounded-md text-sm font-medium">Sign In</button>
                    <div id="user-info" class="hidden items-center space-x-2">
                        <img id="user-photo" class="h-8 w-8 rounded-full" src="" alt="User photo">
                        <button id="signout-btn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md text-sm font-medium">Logout</button>
                    </div>
                </div>
                 <button id="export-btn" class="bg-white text-indigo-600 dark:bg-slate-700 dark:text-slate-200 px-3 py-1 rounded-md text-sm font-medium">Export</button>
                <button id="import-btn-header" class="bg-indigo-700 dark:bg-indigo-600 text-white px-3 py-1 rounded-md text-sm font-medium">Import</button>
            </div>
        </header>

        <!-- Sticky Category Navigation -->
        <div id="sticky-nav" class="sticky top-0 z-20 bg-white dark:bg-slate-800 shadow-md">
            <div class="p-4 border-b border-gray-200 dark:border-slate-700">
                <h3 class="text-lg font-semibold text-gray-700 dark:text-slate-200 mb-3">Categories</h3>
                <div class="flex overflow-x-auto pb-2 space-x-3">
                    <button class="category-btn flex-shrink-0 flex flex-col items-center p-2 bg-indigo-100 dark:bg-indigo-900/50 rounded-lg min-w-[70px] ring-2 ring-indigo-500" data-category="all"><svg xmlns="http://www.w3.org/2000/svg" class="category-icon text-indigo-600 dark:text-indigo-400" viewBox="0 0 20 20" fill="currentColor"><path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg><span class="text-xs mt-1 text-indigo-700 dark:text-indigo-300">All</span></button>
                    <button class="category-btn flex-shrink-0 flex flex-col items-center p-2 bg-red-100 dark:bg-red-900/50 rounded-lg min-w-[70px]" data-category="beef"><span class="text-2xl">ü•©</span><span class="text-xs mt-1 text-red-700 dark:text-red-300">Beef</span></button>
                    <button class="category-btn flex-shrink-0 flex flex-col items-center p-2 bg-orange-100 dark:bg-orange-900/50 rounded-lg min-w-[70px]" data-category="chicken"><span class="text-2xl">üçó</span><span class="text-xs mt-1 text-orange-700 dark:text-orange-300">Chicken</span></button>
                    <button class="category-btn flex-shrink-0 flex flex-col items-center p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg min-w-[70px]" data-category="fish"><span class="text-2xl">üêü</span><span class="text-xs mt-1 text-blue-700 dark:text-blue-300">Fish</span></button>
                    <button class="category-btn flex-shrink-0 flex flex-col items-center p-2 bg-pink-100 dark:bg-pink-900/50 rounded-lg min-w-[70px]" data-category="pork"><span class="text-2xl">üêñ</span><span class="text-xs mt-1 text-pink-700 dark:text-pink-300">Pork</span></button>
                    <button class="category-btn flex-shrink-0 flex flex-col items-center p-2 bg-green-100 dark:bg-green-900/50 rounded-lg min-w-[70px]" data-category="vegetables"><span class="text-2xl">ü•¶</span><span class="text-xs mt-1 text-green-700 dark:text-green-300">Veggies</span></button>
                    <button class="category-btn flex-shrink-0 flex flex-col items-center p-2 bg-yellow-100 dark:bg-yellow-900/50 rounded-lg min-w-[70px]" data-category="frozen"><span class="text-2xl">‚ùÑÔ∏è</span><span class="text-xs mt-1 text-yellow-700 dark:text-yellow-300">Frozen</span></button>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <main class="pb-20">
            <div id="countdown-timer-section" class="p-4 bg-indigo-50 dark:bg-slate-700 border-b border-indigo-200 dark:border-slate-600">
                <h3 class="text-lg font-semibold text-gray-700 dark:text-slate-200 mb-2 text-center">Quick Timer</h3>
                <div id="countdown-display" class="text-6xl font-mono text-center text-indigo-600 dark:text-indigo-400 mb-3">00:00</div>
                <div class="flex justify-center space-x-2 mb-3" id="countdown-inputs">
                    <div><label for="countdown-minutes" class="text-xs text-gray-600 dark:text-slate-400">Minutes</label><input type="number" id="countdown-minutes" min="0" max="99" class="w-20 px-2 py-1 border border-gray-300 rounded-md text-center dark:bg-slate-600 dark:border-slate-500 dark:text-white" placeholder="00"></div>
                    <div><label for="countdown-seconds" class="text-xs text-gray-600 dark:text-slate-400">Seconds</label><input type="number" id="countdown-seconds" min="0" max="59" class="w-20 px-2 py-1 border border-gray-300 rounded-md text-center dark:bg-slate-600 dark:border-slate-500 dark:text-white" placeholder="00"></div>
                </div>
                <div class="flex justify-center space-x-4">
                    <button id="countdown-start-btn" class="p-3 bg-green-500 text-white rounded-full hover:bg-green-600 shadow-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></button>
                    <button id="countdown-pause-btn" class="p-3 bg-yellow-500 text-white rounded-full hover:bg-yellow-600 shadow-md hidden"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></button>
                    <button id="countdown-reset-btn" class="p-3 bg-red-500 text-white rounded-full hover:bg-red-600 shadow-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5M20 20v-5h-5" /><path d="M4 9a9 9 0 0114.65-4.65l-2.12 2.12a5 5 0 00-10.41 2.53" /><path d="M20 15a9 9 0 01-14.65 4.65l2.12-2.12a5 5 0 0010.41-2.53" /></svg></button>
                </div>
            </div>
            <div class="p-4">
                <div id="welcome-message" class="mb-6"><h2 class="text-2xl font-bold text-gray-800 dark:text-slate-100">Air Fryer Cooking Times</h2><p class="text-gray-600 dark:text-slate-300">Track your favorite air fryer cooking times and settings.</p></div>
                <div class="mb-6 flex flex-col sm:flex-row gap-4">
                    <div class="relative flex-grow"><input type="text" id="search-input" class="w-full px-4 py-3 pl-10 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white" placeholder="Search for food items..."><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-3.5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg></div>
                    <div class="flex-shrink-0"><select id="sort-by-select" class="w-full sm:w-auto px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-white"><option value="latest">Sort: Latest Added</option><option value="alpha-asc">Sort: Name (A-Z)</option><option value="alpha-desc">Sort: Name (Z-A)</option><option value="time-desc">Sort: Time (Longest)</option><option value="time-asc">Sort: Time (Shortest)</option></select></div>
                </div>
                <div class="mb-6"><button id="add-timer-btn" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-medium flex items-center justify-center hover:bg-indigo-700 dark:hover:bg-indigo-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" /></svg>Add New Time</button></div>
                <div id="timer-container" class="space-y-4"><div class="text-center py-8 text-gray-500 dark:text-slate-400" id="no-timers"><svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-300 dark:text-slate-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg><p>No timers yet. Add your first timer!</p></div></div>
            </div>
        </main>

        <!-- Bottom Navigation Bar -->
        <nav class="fixed bottom-0 w-full max-w-[480px] bg-white dark:bg-slate-900 border-t border-gray-200 dark:border-slate-700 py-2">
            <div class="flex justify-around">
                <button id="home-btn" class="flex flex-col items-center px-4 py-2 text-indigo-600 dark:text-indigo-400"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg><span class="text-xs mt-1">Home</span></button>
                <button id="favorites-btn" class="flex flex-col items-center px-4 py-2 text-gray-500 dark:text-slate-400"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg><span class="text-xs mt-1">Favorites</span></button>
                <button id="theme-toggle-btn" class="flex flex-col items-center px-4 py-2 text-gray-500 dark:text-slate-400">
                    <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                    <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                    <span class="text-xs mt-1">Theme</span>
                </button>
            </div>
        </nav>

        <!-- Modals -->
        <div id="add-timer-modal" class="add-timer-modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"><div class="bg-white dark:bg-slate-800 rounded-lg p-6 w-11/12 max-w-md max-h-[90vh] overflow-y-auto"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-gray-800 dark:text-slate-100">Add New Timer</h2><button class="close-modal text-gray-500 dark:text-slate-400"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div><form id="timer-form"><input type="hidden" id="timer-id"><div class="mb-4"><label for="food-name" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Food Item</label><input type="text" id="food-name" class="w-full px-3 py-2 border border-gray-300 rounded-md dark:bg-slate-700 dark:border-slate-600 dark:text-white" placeholder="e.g. Chicken Breast, Steak" required></div><div class="mb-4"><label for="food-image" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Image (Optional)</label><input type="file" id="food-image" class="w-full text-sm text-gray-500 dark:text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 dark:file:bg-slate-700 file:text-indigo-700 dark:file:text-indigo-300 hover:file:bg-indigo-100 dark:hover:file:bg-slate-600" accept="image/*"><img id="image-preview" src="" class="hidden mt-2 w-full rounded-md max-h-40 object-cover"/></div><div class="mb-4"><label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Category</label><select id="food-category" class="w-full px-3 py-2 border border-gray-300 rounded-md dark:bg-slate-700 dark:border-slate-600 dark:text-white"><option value="beef">Beef</option><option value="chicken">Chicken</option><option value="fish">Fish</option><option value="pork">Pork</option><option value="vegetables">Vegetables</option><option value="frozen">Frozen Foods</option><option value="other">Other</option></select></div><div class="mb-4"><label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Food State</label><div class="flex space-x-4 text-gray-800 dark:text-slate-200"><label class="flex items-center"><input type="radio" name="food-state" value="fresh" class="mr-2" checked><span>Fresh</span></label><label class="flex items-center"><input type="radio" name="food-state" value="frozen" class="mr-2"><span>Frozen</span></label></div></div><div class="mb-4"><label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Temperature</label><div class="flex items-center mb-2"><input type="range" id="temp-slider" min="160" max="400" value="180" class="w-full temp-slider"><span id="temp-value" class="ml-2 w-16 text-center dark:text-slate-200">180¬∞C</span></div><div class="flex justify-end"><label class="inline-flex items-center cursor-pointer"><span class="mr-2 text-sm text-gray-700 dark:text-slate-300">¬∞C</span><div class="relative"><input type="checkbox" id="temp-unit-toggle" class="sr-only toggle-checked"><div class="w-10 h-5 bg-gray-200 dark:bg-slate-600 rounded-full shadow-inner"></div><div class="toggle-dot absolute w-3 h-3 bg-white rounded-full shadow left-1 top-1 transition"></div></div><span class="ml-2 text-sm text-gray-700 dark:text-slate-300">¬∞F</span></label></div></div><div class="mb-6"><label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Cooking Time</label><div class="flex space-x-2"><div class="w-1/2"><input type="number" id="time-minutes" min="0" max="59" class="w-full px-3 py-2 border border-gray-300 rounded-md dark:bg-slate-700 dark:border-slate-600 dark:text-white" placeholder="Min" required><label class="text-xs text-gray-500 dark:text-slate-400 mt-1 block">Minutes</label></div><div class="w-1/2"><input type="number" id="time-seconds" min="0" max="59" class="w-full px-3 py-2 border border-gray-300 rounded-md dark:bg-slate-700 dark:border-slate-600 dark:text-white" placeholder="Sec"><label class="text-xs text-gray-500 dark:text-slate-400 mt-1 block">Seconds</label></div></div></div><div class="mb-4"><label for="food-notes" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Notes (Optional)</label><textarea id="food-notes" class="w-full px-3 py-2 border border-gray-300 rounded-md dark:bg-slate-700 dark:border-slate-600 dark:text-white" rows="2" placeholder="Any special instructions or notes"></textarea></div><button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-md font-medium hover:bg-indigo-700 dark:hover:bg-indigo-500">Save Timer</button></form></div></div>
        <div id="export-modal" class="export-modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"><div class="bg-white dark:bg-slate-800 rounded-lg p-6 w-11/12 max-w-md"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-gray-800 dark:text-slate-100">Export Your Data</h2><button class="close-modal text-gray-500 dark:text-slate-400"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div><p class="mb-4 text-gray-600 dark:text-slate-300">Save your air fryer timers to your device.</p><div class="mb-4"><button id="download-json-btn" class="w-full bg-indigo-600 text-white py-2 rounded-md font-medium mb-2">Download as JSON</button><button id="copy-json-btn" class="w-full border border-indigo-600 text-indigo-600 dark:text-indigo-300 dark:border-indigo-400 py-2 rounded-md font-medium">Copy to Clipboard</button></div><div class="mt-4"><label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Your Data (JSON format)</label><textarea id="export-data" class="w-full px-3 py-2 border border-gray-300 rounded-md h-32 text-xs font-mono dark:bg-slate-700 dark:border-slate-600 dark:text-white" readonly></textarea></div></div></div>
        <div id="import-modal" class="export-modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"><div class="bg-white dark:bg-slate-800 rounded-lg p-6 w-11/12 max-w-md"><div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold text-gray-800 dark:text-slate-100">Import Your Data</h2><button class="close-modal text-gray-500 dark:text-slate-400"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div><p class="mb-4 text-gray-600 dark:text-slate-300">Restore your timers. This will overwrite current data.</p><div class="mb-4"><label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Upload JSON File</label><input type="file" id="import-file" class="w-full text-sm text-gray-500 dark:text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 dark:file:bg-slate-700 file:text-indigo-700 dark:file:text-indigo-300 hover:file:bg-indigo-100 dark:hover:file:bg-slate-600" accept=".json"></div><div class="mb-4"><p class="text-sm text-gray-500 dark:text-slate-400 mb-2">Or paste your JSON data below:</p><textarea id="import-data" class="w-full px-3 py-2 border border-gray-300 rounded-md h-32 text-xs font-mono dark:bg-slate-700 dark:border-slate-600 dark:text-white" placeholder='Paste your JSON data here...'></textarea></div><button id="import-btn-confirm" class="w-full bg-indigo-600 text-white py-2 rounded-md font-medium">Import Data</button></div></div>
        <div id="toast" class="toast bg-green-500 text-white px-4 py-3 rounded-lg shadow-lg flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg><span id="toast-message">Success!</span></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- THEME MANAGEMENT ---
        const themeToggleBtn = document.getElementById('theme-toggle-btn');
        const themeIconDark = document.getElementById('theme-icon-dark');
        const themeIconLight = document.getElementById('theme-icon-light');

        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                if (themeIconDark) themeIconDark.classList.add('hidden');
                if (themeIconLight) themeIconLight.classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                if (themeIconDark) themeIconDark.classList.remove('hidden');
                if (themeIconLight) themeIconLight.classList.add('hidden');
            }
        }
        
        // This ensures the icon is correct on initial load.
        applyTheme(localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));

        if (themeToggleBtn) {
            themeToggleBtn.addEventListener('click', () => {
                const isDark = document.documentElement.classList.contains('dark');
                const newTheme = isDark ? 'light' : 'dark';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });
        }

        // --- FIREBASE CONFIG & INITIALIZATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyCrFfiJJ6GUi-h5gjeJWvWFa5OVDrw_RNk",
            authDomain: "air-fryer-time-master.firebaseapp.com",
            projectId: "air-fryer-time-master",
            storageBucket: "air-fryer-time-master.firebasestorage.app",
            messagingSenderId: "468916758436",
            appId: "1:468916758436:web:871c4b59820e3d7ad6c331",
            measurementId: "G-B4S43HDY18"
        };
        
        let app, auth, db, googleProvider;
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            googleProvider = new firebase.auth.GoogleAuthProvider();
        } catch (error) {
            console.error("Firebase initialization failed:", error);
        }

        // --- DOM ELEMENT REFERENCES (Remaining) ---
        const addTimerModal = document.getElementById('add-timer-modal');
        const exportModal = document.getElementById('export-modal');
        const importModal = document.getElementById('import-modal');
        const closeModalBtns = document.querySelectorAll('.close-modal');
        const timerForm = document.getElementById('timer-form');
        const addTimerBtn = document.getElementById('add-timer-btn');
        const timerContainer = document.getElementById('timer-container');
        const noTimers = document.getElementById('no-timers');
        const tempSlider = document.getElementById('temp-slider');
        const tempValue = document.getElementById('temp-value');
        const tempUnitToggle = document.getElementById('temp-unit-toggle');
        const searchInput = document.getElementById('search-input');
        const categoryBtns = document.querySelectorAll('.category-btn');
        const exportBtn = document.getElementById('export-btn');
        const importBtnHeader = document.getElementById('import-btn-header');
        const downloadJsonBtn = document.getElementById('download-json-btn');
        const copyJsonBtn = document.getElementById('copy-json-btn');
        const exportDataTextarea = document.getElementById('export-data');
        const importDataTextarea = document.getElementById('import-data');
        const importFileInput = document.getElementById('import-file');
        const importBtnConfirm = document.getElementById('import-btn-confirm');
        const homeBtn = document.getElementById('home-btn');
        const favoritesBtn = document.getElementById('favorites-btn');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const googleSigninBtn = document.getElementById('google-signin-btn');
        const signoutBtn = document.getElementById('signout-btn');
        const userInfoDiv = document.getElementById('user-info');
        const userPhoto = document.getElementById('user-photo');
        const timerIdInput = document.getElementById('timer-id');
        const foodImageInput = document.getElementById('food-image');
        const imagePreview = document.getElementById('image-preview');
        const sortSelect = document.getElementById('sort-by-select');
        const countdownDisplay = document.getElementById('countdown-display');
        const countdownMinutesInput = document.getElementById('countdown-minutes');
        const countdownSecondsInput = document.getElementById('countdown-seconds');
        const countdownStartBtn = document.getElementById('countdown-start-btn');
        const countdownPauseBtn = document.getElementById('countdown-pause-btn');
        const countdownResetBtn = document.getElementById('countdown-reset-btn');
        const countdownInputsDiv = document.getElementById('countdown-inputs');

        // --- APPLICATION STATE ---
        let timers = [];
        let isCelsius = true;
        let currentCategory = 'all';
        let showingFavorites = false;
        let currentUser = null;
        let unsubscribe;
        let countdownInterval;
        let countdownTotalSeconds = 0;
        let isCountdownPaused = false;
        let audioCtx;

        // --- FUNCTION DEFINITIONS ---
        function initAudio() { if (!audioCtx) { audioCtx = new(window.AudioContext || window.webkitAudioContext)(); } }
        function beep(times = 3, duration = 150, delay = 100) { if (!audioCtx) return; let time = audioCtx.currentTime; for (let i = 0; i < times; i++) { const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.type = 'sine'; o.frequency.setValueAtTime(880, time); g.gain.setValueAtTime(0.3, time); g.gain.exponentialRampToValueAtTime(0.0001, time + duration / 1000); o.start(time); o.stop(time + duration / 1000); time += (duration + delay) / 1000; } }
        document.body.addEventListener('click', initAudio, { once: true });

        if (auth) {
            auth.onAuthStateChanged(async user => {
                if (user) {
                    currentUser = user;
                    googleSigninBtn.classList.add('hidden');
                    userInfoDiv.classList.remove('hidden');
                    userInfoDiv.classList.add('flex');
                    userPhoto.src = user.photoURL;
                    if (unsubscribe) unsubscribe();
                    await migrateLocalToFirestore();
                    loadFromFirestore();
                    showToast(`Welcome, ${user.displayName}!`, 'success');
                } else {
                    currentUser = null;
                    googleSigninBtn.classList.remove('hidden');
                    userInfoDiv.classList.add('hidden');
                    userInfoDiv.classList.remove('flex');
                    if (unsubscribe) unsubscribe();
                    timers = [];
                    loadFromLocalStorage();
                    renderTimers();
                }
            });
            googleSigninBtn.addEventListener('click', () => { auth.signInWithPopup(googleProvider).catch(err => { console.error("Sign in error", err); showToast(`Error: ${err.message}`, 'error'); }); });
            signoutBtn.addEventListener('click', () => { auth.signOut(); showToast("You've been signed out.", 'success'); });
        } else {
            document.getElementById('auth-container').style.display = 'none';
            loadFromLocalStorage();
            renderTimers();
        }

        closeModalBtns.forEach(btn => { btn.addEventListener('click', () => { addTimerModal.classList.add('hidden'); exportModal.classList.add('hidden'); importModal.classList.add('hidden'); }); });
        addTimerBtn.addEventListener('click', () => { timerForm.reset(); timerIdInput.value = ''; document.querySelector('#add-timer-modal h2').textContent = "Add New Timer"; imagePreview.src = ''; imagePreview.classList.add('hidden'); addTimerModal.classList.remove('hidden'); });
        timerForm.addEventListener('submit', handleSaveTimer);
        tempSlider.addEventListener('input', updateTempValue);
        tempUnitToggle.addEventListener('change', toggleTempUnit);
        searchInput.addEventListener('input', filterTimers);
        sortSelect.addEventListener('change', filterTimers);
        categoryBtns.forEach(btn => { btn.addEventListener('click', () => { currentCategory = btn.dataset.category; showingFavorites = false; filterTimers(); categoryBtns.forEach(b => b.classList.remove('ring-2', 'ring-indigo-500')); btn.classList.add('ring-2', 'ring-indigo-500'); homeBtn.classList.add('text-indigo-600', 'dark:text-indigo-400'); homeBtn.classList.remove('text-gray-500', 'dark:text-slate-400'); favoritesBtn.classList.remove('text-indigo-600', 'dark:text-indigo-400'); favoritesBtn.classList.add('text-gray-500', 'dark:text-slate-400'); timerContainer.scrollIntoView({ behavior: 'smooth' }); }); });
        exportBtn.addEventListener('click', () => { exportDataTextarea.value = JSON.stringify(timers, null, 2); exportModal.classList.remove('hidden'); });
        importBtnHeader.addEventListener('click', () => { importModal.classList.remove('hidden'); });
        downloadJsonBtn.addEventListener('click', () => { const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(timers)); const a = document.createElement('a'); a.setAttribute("href", dataStr); a.setAttribute("download", "air_fryer_timers.json"); document.body.appendChild(a); a.click(); a.remove(); showToast("Data downloaded!"); });
        copyJsonBtn.addEventListener('click', () => { exportDataTextarea.select(); document.execCommand('copy'); showToast("Data copied!"); });
        importBtnConfirm.addEventListener('click', handleImport);
        homeBtn.addEventListener('click', () => { showingFavorites = false; currentCategory = 'all'; filterTimers(); categoryBtns.forEach(b => b.classList.remove('ring-2', 'ring-indigo-500')); document.querySelector('.category-btn[data-category="all"]').classList.add('ring-2', 'ring-indigo-500'); homeBtn.classList.add('text-indigo-600', 'dark:text-indigo-400'); homeBtn.classList.remove('text-gray-500', 'dark:text-slate-400'); favoritesBtn.classList.remove('text-indigo-600', 'dark:text-indigo-400'); favoritesBtn.classList.add('text-gray-500', 'dark:text-slate-400'); });
        favoritesBtn.addEventListener('click', () => { showingFavorites = true; filterTimers(); categoryBtns.forEach(b => b.classList.remove('ring-2', 'ring-indigo-500')); favoritesBtn.classList.add('text-indigo-600', 'dark:text-indigo-400'); favoritesBtn.classList.remove('text-gray-500', 'dark:text-slate-400'); homeBtn.classList.remove('text-indigo-600', 'dark:text-indigo-400'); homeBtn.classList.add('text-gray-500', 'dark:text-slate-400'); });
        foodImageInput.addEventListener('change', () => { const file = foodImageInput.files[0]; if (file) { const reader = new FileReader(); reader.onload = (e) => { imagePreview.src = e.target.result; imagePreview.classList.remove('hidden'); }; reader.readAsDataURL(file); } else { imagePreview.src = ''; imagePreview.classList.add('hidden'); } });
        countdownStartBtn.addEventListener('click', startCountdown);
        countdownPauseBtn.addEventListener('click', pauseCountdown);
        countdownResetBtn.addEventListener('click', resetCountdown);

        async function handleSaveTimer(e) { e.preventDefault(); const id = timerIdInput.value || Date.now().toString(); const isEditing = !!timerIdInput.value; const toBase64 = file => new Promise((resolve, reject) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = () => resolve(reader.result); reader.onerror = error => reject(error); }); let imageUrl = ''; const imageFile = foodImageInput.files[0]; if (imageFile) { imageUrl = await toBase64(imageFile); } else if (isEditing) { const existingTimer = timers.find(t => t.id === id); imageUrl = existingTimer?.imageUrl || ''; } const timerData = { id: id, name: document.getElementById('food-name').value, imageUrl: imageUrl, category: document.getElementById('food-category').value, foodState: document.querySelector('input[name="food-state"]:checked').value, temperature: parseInt(tempSlider.value), tempUnit: isCelsius ? 'C' : 'F', minutes: parseInt(document.getElementById('time-minutes').value) || 0, seconds: parseInt(document.getElementById('time-seconds').value) || 0, notes: document.getElementById('food-notes').value, favorite: isEditing ? (timers.find(t => t.id === id)?.favorite || false) : false }; if (currentUser && db) { try { await db.collection('users').doc(currentUser.uid).collection('timers').doc(id).set(timerData); showToast(`Timer ${isEditing ? 'updated' : 'added'}!`); } catch (err) { showToast(`Error: ${err.message}`, 'error'); } } else { if (isEditing) { const index = timers.findIndex(t => t.id.toString() === id); if (index !== -1) timers[index] = timerData; } else { timers.unshift(timerData); } saveToLocalStorage(); renderTimers(); showToast(`Timer ${isEditing ? 'updated' : 'added'}!`); } addTimerModal.classList.add('hidden'); timerForm.reset(); }
        function handleImport() { let importedData; const processData = (dataString) => { try { importedData = JSON.parse(dataString); if (!Array.isArray(importedData)) { showToast("Invalid data format!", "error"); return; } if (currentUser && db) { const batch = db.batch(); const collectionRef = db.collection('users').doc(currentUser.uid).collection('timers'); importedData.forEach(timer => { const docRef = collectionRef.doc(timer.id.toString()); batch.set(docRef, timer); }); batch.commit().then(() => { showToast("Data imported!"); importModal.classList.add('hidden'); }).catch(err => showToast(`Import failed: ${err.message}`, 'error')); } else { timers = importedData; saveToLocalStorage(); renderTimers(); importModal.classList.add('hidden'); showToast("Data imported!"); } } catch (error) { showToast("Error parsing JSON!", "error"); } }; if (importFileInput.files.length > 0) { const file = importFileInput.files[0]; const reader = new FileReader(); reader.onload = (e) => processData(e.target.result); reader.readAsText(file); } else if (importDataTextarea.value.trim() !== '') { processData(importDataTextarea.value); } else { showToast("No data to import!", "error"); } }
        function updateTempValue() { const temp = tempSlider.value; tempValue.textContent = `${temp}¬∞${isCelsius ? 'C' : 'F'}`; }
        function toggleTempUnit() { isCelsius = !tempUnitToggle.checked; const currentTemp = parseInt(tempSlider.value); let newTemp; if (isCelsius) { newTemp = Math.round((currentTemp - 32) * 5 / 9); tempSlider.min = "160"; tempSlider.max = "230"; tempSlider.value = Math.max(160, Math.min(230, newTemp)); } else { newTemp = Math.round(currentTemp * 9 / 5 + 32); tempSlider.min = "320"; tempSlider.max = "450"; tempSlider.value = Math.max(320, Math.min(450, newTemp)); } updateTempValue(); }
        function filterTimers() { let filteredTimers = [...timers]; const searchTerm = searchInput.value.toLowerCase(); if (showingFavorites) { filteredTimers = filteredTimers.filter(timer => timer.favorite); } else if (currentCategory !== 'all') { filteredTimers = filteredTimers.filter(timer => timer.category === currentCategory); } if (searchTerm) { filteredTimers = filteredTimers.filter(timer => timer.name.toLowerCase().includes(searchTerm)); } const sortBy = sortSelect.value; switch (sortBy) { case 'latest': filteredTimers.sort((a, b) => b.id - a.id); break; case 'alpha-asc': filteredTimers.sort((a, b) => a.name.localeCompare(b.name)); break; case 'alpha-desc': filteredTimers.sort((a, b) => b.name.localeCompare(a.name)); break; case 'time-asc': filteredTimers.sort((a, b) => (a.minutes * 60 + (a.seconds || 0)) - (b.minutes * 60 + (b.seconds || 0))); break; case 'time-desc': filteredTimers.sort((a, b) => (b.minutes * 60 + (b.seconds || 0)) - (a.minutes * 60 + (a.seconds || 0))); break; } renderFilteredTimers(filteredTimers); }
        function renderFilteredTimers(filteredTimers) { if (filteredTimers.length === 0) { timerContainer.innerHTML = `<div class="text-center py-8 text-gray-500 dark:text-slate-400" id="no-timers-message"><p>${showingFavorites ? 'No favorites found.' : 'No matching timers found.'}</p></div>`; return; } timerContainer.innerHTML = ''; filteredTimers.forEach(timer => { const timeString = timer.seconds > 0 ? `${timer.minutes}m ${timer.seconds}s` : `${timer.minutes} min`; let categoryColor; switch (timer.category) { case 'beef': categoryColor = 'red'; break; case 'chicken': categoryColor = 'orange'; break; case 'fish': categoryColor = 'blue'; break; case 'pork': categoryColor = 'pink'; break; case 'vegetables': categoryColor = 'green'; break; case 'frozen': categoryColor = 'yellow'; break; default: categoryColor = 'gray'; } const card = document.createElement('div'); card.className = 'card bg-white dark:bg-slate-700 rounded-lg shadow overflow-hidden border border-gray-100 dark:border-slate-600'; card.innerHTML = `${timer.imageUrl ? `<img src="${timer.imageUrl}" alt="${timer.name}" class="w-full h-40 object-cover">` : ''}<div class="p-4"><div class="flex justify-between items-start"><div><h3 class="font-bold text-lg text-gray-800 dark:text-slate-100">${timer.name}</h3><div class="flex items-center mt-1 space-x-2"><span class="px-2 py-1 bg-${categoryColor}-100 text-${categoryColor}-800 dark:bg-${categoryColor}-900/50 dark:text-${categoryColor}-300 text-xs rounded-full">${timer.category.charAt(0).toUpperCase() + timer.category.slice(1)}</span><span class="px-2 py-1 bg-${timer.foodState === 'frozen' ? 'blue' : 'green'}-100 text-${timer.foodState === 'frozen' ? 'blue' : 'green'}-800 dark:bg-${timer.foodState === 'frozen' ? 'blue' : 'green'}-900/50 dark:text-${timer.foodState === 'frozen' ? 'blue' : 'green'}-300 text-xs rounded-full">${timer.foodState.charAt(0).toUpperCase() + timer.foodState.slice(1)}</span></div></div><div class="flex flex-col items-end"><div class="text-indigo-600 dark:text-indigo-400 font-bold">${timer.temperature}¬∞${timer.tempUnit}</div><div class="text-gray-500 dark:text-slate-400 text-sm">${timeString}</div></div></div>${timer.notes ? `<p class="text-gray-600 dark:text-slate-300 text-sm mt-2 border-t border-gray-100 dark:border-slate-600 pt-2">${timer.notes}</p>` : ''}<div class="flex justify-end items-center mt-3"><button class="text-indigo-500 dark:text-indigo-400 mr-2 start-main-timer" title="Start this timer" data-minutes="${timer.minutes}" data-seconds="${timer.seconds || 0}"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" /></svg></button><button class="text-gray-500 dark:text-slate-400 mr-2 favorite-timer" data-id="${timer.id}" title="Favorite"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ${timer.favorite ? 'text-yellow-400 fill-current' : ''}" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg></button><button class="text-gray-500 dark:text-slate-400 mr-2 edit-timer" data-id="${timer.id}" title="Edit"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg></button><button class="text-red-500 dark:text-red-400 delete-timer" data-id="${timer.id}" title="Delete"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button></div></div>`; timerContainer.appendChild(card); card.querySelector('.delete-timer').addEventListener('click', () => deleteTimer(timer.id)); card.querySelector('.edit-timer').addEventListener('click', () => editTimer(timer)); card.querySelector('.favorite-timer').addEventListener('click', () => toggleFavorite(timer.id)); card.querySelector('.start-main-timer').addEventListener('click', (e) => { const btn = e.currentTarget; const minutes = btn.dataset.minutes; const seconds = btn.dataset.seconds; loadAndStartCountdown(minutes, seconds); }); }); }
        function renderTimers() { if (!timers || timers.length === 0) { timerContainer.innerHTML = ''; timerContainer.appendChild(noTimers); noTimers.classList.remove('hidden'); return; } noTimers.classList.add('hidden'); filterTimers(); }
        async function deleteTimer(id) { if (confirm("Are you sure?")) { if (currentUser && db) { try { await db.collection('users').doc(currentUser.uid).collection('timers').doc(id.toString()).delete(); showToast("Timer deleted!"); } catch (err) { showToast(`Error: ${err.message}`, 'error'); } } else { timers = timers.filter(timer => timer.id.toString() !== id.toString()); saveToLocalStorage(); renderTimers(); showToast("Timer deleted!"); } } }
        function editTimer(timerToEdit) { document.querySelector('#add-timer-modal h2').textContent = "Edit Timer"; timerIdInput.value = timerToEdit.id; document.getElementById('food-name').value = timerToEdit.name; document.getElementById('food-category').value = timerToEdit.category; document.querySelector(`input[name="food-state"][value="${timerToEdit.foodState}"]`).checked = true; tempSlider.value = timerToEdit.temperature; tempUnitToggle.checked = timerToEdit.tempUnit === 'F'; isCelsius = timerToEdit.tempUnit === 'C'; updateTempValue(); document.getElementById('time-minutes').value = timerToEdit.minutes; document.getElementById('time-seconds').value = timerToEdit.seconds || ''; document.getElementById('food-notes').value = timerToEdit.notes || ''; if (timerToEdit.imageUrl) { imagePreview.src = timerToEdit.imageUrl; imagePreview.classList.remove('hidden'); } else { imagePreview.src = ''; imagePreview.classList.add('hidden'); } addTimerModal.classList.remove('hidden'); }
        async function toggleFavorite(id) { const timer = timers.find(t => t.id.toString() === id.toString()); if (!timer) return; const newFavoriteState = !timer.favorite; if (currentUser && db) { try { await db.collection('users').doc(currentUser.uid).collection('timers').doc(id.toString()).update({ favorite: newFavoriteState }); } catch (err) { showToast(`Error: ${err.message}`, 'error'); } } else { timer.favorite = newFavoriteState; saveToLocalStorage(); renderTimers(); } }
        function updateCountdownDisplay() { const minutes = Math.floor(countdownTotalSeconds / 60); const seconds = countdownTotalSeconds % 60; countdownDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`; }
        function startCountdown() { if (!isCountdownPaused) { const minutes = parseInt(countdownMinutesInput.value) || 0; const seconds = parseInt(countdownSecondsInput.value) || 0; countdownTotalSeconds = (minutes * 60) + seconds; } if (countdownTotalSeconds <= 0) { showToast("Set a time first.", "error"); return; } initAudio(); isCountdownPaused = false; countdownStartBtn.classList.add('hidden'); countdownPauseBtn.classList.remove('hidden'); countdownInputsDiv.classList.add('hidden'); countdownInterval = setInterval(() => { countdownTotalSeconds--; updateCountdownDisplay(); if (countdownTotalSeconds <= 0) { clearInterval(countdownInterval); beep(); resetCountdown(); showToast("Time's up!", "success"); } }, 1000); }
        function pauseCountdown() { isCountdownPaused = true; clearInterval(countdownInterval); countdownStartBtn.classList.remove('hidden'); countdownPauseBtn.classList.add('hidden'); }
        function resetCountdown() { clearInterval(countdownInterval); isCountdownPaused = false; countdownTotalSeconds = 0; updateCountdownDisplay(); countdownMinutesInput.value = ''; countdownSecondsInput.value = ''; countdownStartBtn.classList.remove('hidden'); countdownPauseBtn.classList.add('hidden'); countdownInputsDiv.classList.remove('hidden'); }
        function loadAndStartCountdown(minutes, seconds) { resetCountdown(); countdownMinutesInput.value = minutes; countdownSecondsInput.value = seconds; startCountdown(); document.getElementById('countdown-timer-section').scrollIntoView({ behavior: 'smooth' }); }
        function saveToLocalStorage() { if (currentUser) return; localStorage.setItem('airFryerTimers', JSON.stringify(timers)); }
        function loadFromLocalStorage() { const savedTimers = localStorage.getItem('airFryerTimers'); if (savedTimers) { timers = JSON.parse(savedTimers); } else { timers = getSampleTimers(); } renderTimers(); }
        function loadFromFirestore() { if (!currentUser || !db) return; const collectionRef = db.collection('users').doc(currentUser.uid).collection('timers'); unsubscribe = collectionRef.onSnapshot(snapshot => { timers = snapshot.docs.map(doc => doc.data()); renderTimers(); }, error => { console.error("Error fetching timers:", error); showToast("Could not load timers.", "error"); }); }
        async function migrateLocalToFirestore() { const localData = localStorage.getItem('airFryerTimers'); if (!localData || !currentUser || !db) return; const collectionRef = db.collection('users').doc(currentUser.uid).collection('timers'); const snapshot = await collectionRef.limit(1).get(); if (snapshot.empty) { const localTimers = JSON.parse(localData); const batch = db.batch(); localTimers.forEach(timer => { const docRef = collectionRef.doc(timer.id.toString()); batch.set(docRef, timer); }); await batch.commit(); localStorage.removeItem('airFryerTimers'); showToast('Local data moved to account!', 'success'); } }
        function showToast(message, type = 'success') { toastMessage.textContent = message; toast.className = `toast shadow-lg flex items-center text-white px-4 py-3 rounded-lg ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 3000); }
        function getSampleTimers() { return [{ id: 1, name: "Chicken Breast (6 oz)", category: "chicken", foodState: "fresh", temperature: 190, tempUnit: "C", minutes: 15, seconds: 0, notes: "Flip halfway through.", favorite: false }, { id: 2, name: "Ribeye Steak (1 inch)", category: "beef", foodState: "fresh", temperature: 200, tempUnit: "C", minutes: 12, seconds: 0, notes: "For medium rare.", favorite: true }, { id: 6, name: "Brussels Sprouts", category: "vegetables", foodState: "fresh", temperature: 190, tempUnit: "C", minutes: 10, seconds: 0, notes: "Toss with olive oil.", favorite: true }, { id: 10, name: "Frozen Mozzarella Sticks", category: "frozen", foodState: "frozen", temperature: 190, tempUnit: "C", minutes: 6, seconds: 0, notes: "No need to thaw.", favorite: false }, ]; }
    });
    </script>
</body>
</html>

